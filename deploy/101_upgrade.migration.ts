import { ethers } from "hardhat";
import { Deployer } from "@solarity/hardhat-migrate";

import { RegistrationMethodId } from "@/test/helpers/constants";

import { Registration2, Registration2__factory } from "@ethers-v6";

let counter = 0;

async function upgradeCertificates(registration: Registration2) {
  const coder = ethers.AbiCoder.defaultAbiCoder();

  const paths = [
    [],
    ["0x5ab1b6fd33b587d6fca224374916ad1a43c53b3f34600e4b68b1033c0c3548e9"],
    ["0xda41f547650ff74a2cbdd8c85941fa1c7ccc029942664ebe34469034d3726393"],
    ["0x2ecdc47ba435e2690104fe1aaf7a6b79db042b474a2fa7fb2e221776961ecad0"],
  ];
  const sigs = [
    "0x72e8fdf3cfdbb1f37cbae3a1f0e003c087194678835e47d42221f42156b126c0522f7ff62c497e30045a688d5026bd3821cde2091d2c5448b43f09c6e654b4a001",
    "0x0f89c3b047372522478258d8004a2a696740ba0e68976a4fe28297e129c9474e3e3706738fb5941fb6ed21745f0c30972d0d6a63bd6ad3c99fbca99de6bb363501",
    "0x0f89c3b047372522478258d8004a2a696740ba0e68976a4fe28297e129c9474e3e3706738fb5941fb6ed21745f0c30972d0d6a63bd6ad3c99fbca99de6bb363501",
    "0x66c0f9028431eedfc10ae2ef121282910bbe24514ff3dfdb226108f81dd0bb710716505c2259ce4f579eed505f7924d2bcd2807b0a6bfe6a115ace247e35833400",
  ];
  const data = [
    "0xf859d0fcb0795f98b7836dad9da684ba697f345219d52df5c035b65639a1a4150000000000000000000000003b4e7eef17d2dc46a542e957ea807d0ca9fdcfe5",
    "0xd148c3ba804fe6981afde5353d5076ca7f18dad676d7c9f3ccd47a7a280768b600000000000000000000000097ac71083e10e482c99abd0e151f468c097ce8d4",
    "0xcf4edef1e314d92538b692be63d2fed3375e3a8896eca500c2bcce6954b1fe37000000000000000000000000bd91c19a09e152b537c7178abdb8f813942996c9",
    "0xaa013b1b8dd3e14de79cd967bcc496f0608e746fd13ce03c2393744911909207000000000000000000000000b8e0d40b7474afd7c1623a4fb927e20cd63fa8e0",
  ];

  for (let i = 0; i < sigs.length; i++) {
    console.log(++counter);

    let proof = coder.encode(["bytes32[]", "bytes"], [paths[i], ethers.toBeHex(BigInt(sigs[i]) + 27n)]);

    await registration.updateDependency(RegistrationMethodId.AddCertificateDispatcher, data[i], proof);
  }
}

async function upgradePassports(registration: Registration2) {
  const coder = ethers.AbiCoder.defaultAbiCoder();

  const paths = [
    ["0xf82a355ae562cd62d6aa52fa6b697f2f1cf7d90a4e04aaddb75d9874c38f23dc"],
    [
      "0x5695d4bfcfdd3f2245d4eb5c58cd1995cc88056612447d18e686f79c8330c337",
      "0xff9da686370db650329b8be20c2b5ed171500cd9622a61b0aa641247c1716613",
    ],
  ];
  const sigs = [
    "0x66c0f9028431eedfc10ae2ef121282910bbe24514ff3dfdb226108f81dd0bb710716505c2259ce4f579eed505f7924d2bcd2807b0a6bfe6a115ace247e35833400",
    "0x857c8b3b97b1070725e41f0ffa61f8e3b91e1cc7c1469249f44ebfa32340448250954ac41838314af1e642d4529ef3131530bed54997010f6ec2619d570e806a01",
  ];
  const data = [
    "0xbf9f2b1aaae845f79994bafab4bb5f48d381b9c559508ac2273a9f7d58a0823200000000000000000000000045aba153226cf178afa32f19504b46ce85c0f623",
    "0x58b951a67e113d44eb0446b5fcbf91ad35952857784f53ee3c69aa5022acf179000000000000000000000000fe82a62db662784801cdaad32ed2c3cb855d5f79",
  ];

  for (let i = 0; i < sigs.length; i++) {
    console.log(++counter);

    let proof = coder.encode(["bytes32[]", "bytes"], [paths[i], ethers.toBeHex(BigInt(sigs[i]) + 27n)]);

    await registration.updateDependency(RegistrationMethodId.AddPassportDispatcher, data[i], proof);
  }
}

async function upgradeVerifiers(registration: Registration2) {
  const coder = ethers.AbiCoder.defaultAbiCoder();

  const paths = [
    [
      "0x2bb98d383c8cc2ace3c31a811cd0f66de51e0e3c0f3b5f42cadb4e7b379955e1",
      "0xff9da686370db650329b8be20c2b5ed171500cd9622a61b0aa641247c1716613",
    ],
    ["0xf010006d72902920cebe8c937bceab4008f482a614949b8dc78366349d102cb1"],
    [
      "0x643706213462c0e381361d88f63a54a238f72b03ac5740fd7eaa30ae53814d2c",
      "0x5b165424dce8e4a6c40c5a49eb5cf2fb285d311b644dba1edef00fed2d30de93",
    ],
    [
      "0xf547c0dc210eadeb08cbc0f99c2da5ce39be5d76ca466a4b9faf393916647290",
      "0x5b165424dce8e4a6c40c5a49eb5cf2fb285d311b644dba1edef00fed2d30de93",
    ],
    [
      "0x8a2666a29b7c82cdc7c565258912d8c443f24a9543b8f080328dcef1fc945360",
      "0x42c4ab2d2c9b51c24e7481ecdc62c5b64985e07d764439cfede7e85616afea1b",
    ],
    [
      "0x8ede2ae06d5666345ceb7fd4ed1dcfdc8a2953fa494c63b1ab01047926b76a4e",
      "0x42c4ab2d2c9b51c24e7481ecdc62c5b64985e07d764439cfede7e85616afea1b",
    ],
    ["0xd3d9ae8593ca4434a875d229d831b8e26ddcd81ad461dfccb117972f98952826"],
    ["0x323bb1c6875bc072493be4f7b2c5bd871ca9eabc9724375f06ffced88e3ef0aa"],
    ["0x80193195acd6daa207789887186be3b62fe4887a792404605d6465dede811863"],
    ["0x96d479e68f3037620c3ab392942a91e7cae47013e7c4bf8d93e1041d678efbb2"],
    [],
    [
      "0x4c810ca4de363c72501d0eaaf57d88cd58b8411ae436de122a4b1ae103c9f8cd",
      "0x0630c7ac36df729ab841bc526bb88ef93779a1eed7a24dce0b683770140e10e5",
    ],
    [
      "0xdd670e128906b53b62e36f340466eaf41f99d5b7c67eff7cce8deeb74a6812bf",
      "0x0630c7ac36df729ab841bc526bb88ef93779a1eed7a24dce0b683770140e10e5",
    ],
    [
      "0xa596bc5e42c0218f96ecb51c637d2e6081e0ae7e7b4412425ae0b6afaab0431f",
      "0x9a31399c1ee488c3ad187e36acd8b3c0174e12dd93e8e7ac0fce39bb3f518943",
    ],
    [
      "0xd1cc7297d9a2686e5a6bd14b5fbd06d76819024d4ab54aecebf69bb55ca0c454",
      "0x9a31399c1ee488c3ad187e36acd8b3c0174e12dd93e8e7ac0fce39bb3f518943",
    ],
    [
      "0xa519a90ca623d6d2d80c67d19d031e21892c9a545ababa82445c55a806263053",
      "0x517a06d968765595a0015518d125b244a6ac47e6595868191e105c32118d71f7",
    ],
    [
      "0x5c7735185025d66efa1f7d8d57339f79c9da33594896dd5a8c07dbe952c87115",
      "0x517a06d968765595a0015518d125b244a6ac47e6595868191e105c32118d71f7",
    ],
  ];
  const sigs = [
    "0x857c8b3b97b1070725e41f0ffa61f8e3b91e1cc7c1469249f44ebfa32340448250954ac41838314af1e642d4529ef3131530bed54997010f6ec2619d570e806a01",
    "0x857c8b3b97b1070725e41f0ffa61f8e3b91e1cc7c1469249f44ebfa32340448250954ac41838314af1e642d4529ef3131530bed54997010f6ec2619d570e806a01",
    "0x1849376b0b029b51fdbc8eb5221a9443666bafed21037e621cc1eaad78b459fa7750c1a7415727f4a74f9781fac7bb37ef3d90d5f1cbee7315b84d77ada976a501",
    "0x1849376b0b029b51fdbc8eb5221a9443666bafed21037e621cc1eaad78b459fa7750c1a7415727f4a74f9781fac7bb37ef3d90d5f1cbee7315b84d77ada976a501",
    "0x1849376b0b029b51fdbc8eb5221a9443666bafed21037e621cc1eaad78b459fa7750c1a7415727f4a74f9781fac7bb37ef3d90d5f1cbee7315b84d77ada976a501",
    "0x1849376b0b029b51fdbc8eb5221a9443666bafed21037e621cc1eaad78b459fa7750c1a7415727f4a74f9781fac7bb37ef3d90d5f1cbee7315b84d77ada976a501",
    "0x254abfb724a7987ef6a9283708d6da8b895a59aceda962bf625ec706fbad61370cb471940a56bfcc251eaeb822a743af658b215024f1080d5b6a1790f457268201",
    "0x254abfb724a7987ef6a9283708d6da8b895a59aceda962bf625ec706fbad61370cb471940a56bfcc251eaeb822a743af658b215024f1080d5b6a1790f457268201",
    "0xfdda5c5919a2aff55e473b348cf619a38fe44e3f505265c2051596e1c5431beb7491402c3ea01bddabc0756c699131144c7a51047689ffd2ae659ffb4643eaaa01",
    "0xfdda5c5919a2aff55e473b348cf619a38fe44e3f505265c2051596e1c5431beb7491402c3ea01bddabc0756c699131144c7a51047689ffd2ae659ffb4643eaaa01",
    "0xf905ebc37d110336a09ba00c0a8ae4abd75e90ac39de5442490a3c8d0e4ffea11daf0dd8a29eb416133a1f4d33ba640085459eba5e7b16c56cb1a9f03e00dd4800",
    "0x549510ec8b1591393eebd243f674d205c64fa5a010ebc5f39656f5bcdb19ef706a43de9ebb53bf94cc8397d58e862595654c3ff9eba9eb478847e274911f072100",
    "0x549510ec8b1591393eebd243f674d205c64fa5a010ebc5f39656f5bcdb19ef706a43de9ebb53bf94cc8397d58e862595654c3ff9eba9eb478847e274911f072100",
    "0x549510ec8b1591393eebd243f674d205c64fa5a010ebc5f39656f5bcdb19ef706a43de9ebb53bf94cc8397d58e862595654c3ff9eba9eb478847e274911f072100",
    "0x549510ec8b1591393eebd243f674d205c64fa5a010ebc5f39656f5bcdb19ef706a43de9ebb53bf94cc8397d58e862595654c3ff9eba9eb478847e274911f072100",
    "0x31e73e57d8eede70b03a068cc3cda2714d063ee8c62dce488b12a1a07ed1780e0c831a612914bbec8a4b1f78f9b660d4dfaddad36dafc16b6d66f8cc7ddc5ed000",
    "0x31e73e57d8eede70b03a068cc3cda2714d063ee8c62dce488b12a1a07ed1780e0c831a612914bbec8a4b1f78f9b660d4dfaddad36dafc16b6d66f8cc7ddc5ed000",
  ];
  const data = [
    "0xf0667b354e8107bdc47c021641b81ac26d78652df3c8f71e95565f7d07ea02420000000000000000000000003b8457c5199ec271d3fea0e26d07c072f4a294a8",
    "0xb50f55e9920a4ca38ca6541c0d59bff1c7008bddba37cbb68ab0272c3cfd1565000000000000000000000000846633146334d8d0409a483a21627fb7d28f6b61",
    "0xd212c89d57634d107d0a56be8654a7617deddfa6c1824d9b435921eca4668821000000000000000000000000cffad11249afed593cbcf73e67880293084177de",
    "0xf8cc7e4caaae8ac8c4a2dcb618d3ed9f6772fb2fd9fc206bfa546a798ba36015000000000000000000000000075859d363e5d1fd61445d33bf36b795dfa6fef5",
    "0x5dc3a2e56ed39dac14f7cb14d8695717672b34661bc03401827b20de96823eaa0000000000000000000000003d60ad6b73b0119d307fd3be2fbc803a67047096",
    "0xb087e7836f347ebc469ce8a8f73c8dbe43e80c78345ab05fc606197a0d9f4a9e00000000000000000000000060b03103fd28b5c18ae9c37fbcc26f735b119835",
    "0x9dba0c5704c79dee26bafe5a0b899a9d016329a89039caf45a592a79d515c005000000000000000000000000cd75c649169f694ddddd5fc97d9eb64116afa9ae",
    "0xf64fd053d8d0172e4688e3b8ba9ef46904716a7e6515e0e5a426b34ef4c5bc5c000000000000000000000000444320f2251f1997e63c08935a98d957af9e0655",
    "0x0b89bf2e7370ee3cf5a05c7573e0054484accd901ea4e5abf0d4cde730971d9b000000000000000000000000565efd1eeb56a14844c37408c19c650451fe2151",
    "0x02500c37d979282f90f6779ed098d9dcc2c5862866892cf1641e3882d93fba200000000000000000000000005d3e2ed523cbff51047089cf034062a0f2c1df4f",
    "0x5da023d739bf59eec2f37128c4631c19964c1daad7be6184cf76a3ad5af6f134000000000000000000000000cab13166e4005e03cc42377a5100b9fa4ad1634a",
    "0xf37bafdcad6d431fa01f6b1d90537b9107d70dac07791c48f05f1aaa2310c066000000000000000000000000c11c9dce07e22f5d12e93988c4b4d00a5488a703",
    "0x521fa0e94742eea61224135c8e0bd5e7fc9b9dcdcbd46aea23e7ae5f4baf70e000000000000000000000000080b28c60ee94cec68534ba2eaa53b422398528fb",
    "0x9f05add0e79e69cf31cf4b77111c1b2b9e198042e7019a059c2d9acbf5478cc2000000000000000000000000bf339a142ed370d3ff213718963f9512e9e1a82f",
    "0x98ca4240851d7c3f8eb2e6353a0198c968c11276ec018a4de4710e7bfef0a20e00000000000000000000000021950125d071704125802b8a21e82c2283e1c934",
    "0xf5e18f6f6c624939988a412b40de8d15bd3eed349f0eb7ad51105d1a1c6a83fd00000000000000000000000088240185a74f020b94b14fae3e6d5dde1aa9057b",
    "0x96c37f83e8ea2f7927406c6f88ac9708eea17108162a43ab8c32962d427273dc000000000000000000000000d834e37ff7e9765e7eaa4c6ac5080e920ec5c170",
  ];

  for (let i = 0; i < sigs.length; i++) {
    console.log(++counter);

    let proof = coder.encode(["bytes32[]", "bytes"], [paths[i], ethers.toBeHex(BigInt(sigs[i]) + 27n)]);

    await registration.updateDependency(RegistrationMethodId.AddPassportVerifier, data[i], proof);
  }
}

export = async (deployer: Deployer) => {
  const registration = await deployer.deployed(Registration2__factory, "0xC0B09085Fa2ad3A8BbF96494B8d5cd10702FE20d");

  await upgradeCertificates(registration);
  await upgradePassports(registration);
  await upgradeVerifiers(registration);

  console.log("OK");
};

import { ethers } from "hardhat";
import { expect } from "chai";
import { Reverter } from "@/test/helpers/";

import { CRSAPSSSHA512Signer } from "@ethers-v6";

describe("CRSAPSSSHA512Signer", () => {
  const reverter = new Reverter();

  let signer: CRSAPSSSHA512Signer;

  before("setup", async () => {
    const CRSAPSSSHA512Signer = await ethers.getContractFactory("CRSAPSSSHA512Signer");

    signer = await CRSAPSSSHA512Signer.deploy();

    await signer.__CRSAPSSSHA512Signer_init(65537);

    await reverter.snapshot();
  });

  afterEach(reverter.revert);

  describe("#verifyICAOSignature", () => {
    it.only("should verify icao signature 1", async () => {
      const signedAttributes = ethers.hexlify(ethers.toUtf8Bytes("hello world"));
      const icaoMemberSignature =
        "0x99c5cff18453094dfb638995a5b24263114a64e613eb51029e0957c8dbcf889679231002fb034b1f4d3638c9995144c953eccf08d664c6db380780940b98414499ad60a02c1cda4002c76f2a0ef4f692986a9b4de2bcd20958cbc1407b19ce7f2998b202947d305ec74cddbec1e441f3f40a9cf656bc2f3319871d40227cc5b24f8774955dc6f96d2b9756d06325e44e9e45ae27d1cde2e9ba2cc7e21725dcf14add4df246ae7bcc42f7d49b04086f3480efc1887d97500cf452ba61bf68400207dd47b0c5ef7e15c30fbdf89ded6435ab2968f2a17cd0658868f31d3c331e3db798d1a5e07a125d6a9aa0dc374d4801c32777144f4bd709ea94d1658ea49cafc8bf610d3d15aadbfe85836274e39c121618b8b8a1eb97580d7089c9b7fd031713756dda16fd8083802ee93b4b1f0f9cb781518755a8c2a517f8fa58c0e2b920d4da52c29af414ef41654acf8b2061e88646073aa6f51b5bf87b26f7d9b692f100d9e8abafde12092a036d448b08a5dd67c7c344833b6df2ee142b0c8af41172ee9d5afd2bdd68828a139bb7b7cd0c4f2172291272cdac7e3789472b841ddfff45b79391d2a087cd9e8ff018d6f0c2a516b4a8de41504fd7b1a8c470e5f09984015935e39d8dd60089bbbf950d2f1f9a7e892a17a0423c0c44ad1e9579fd6e97adab4cc9de3f4227932805b221ab0cb359345f69c6cdc2ac45706d700181474f";
      const icaoMemberKey =
        "0x9e018f82df2c04823cc243d27c539f42d66cc7cd3373ae39ccd45e9630d0d61587b3c9c4604af15a8435cd5316e0cf9994553ece9a66148aff562d72ce26739a65594a2b4597b8f37e7bf8c08b48c31f0148a97f18306e1f55f10380db36ac3410e44a6a923eb9682aa51482759dc130971f8762be8e2f84eaeb053fb85908226038f73a8f400167ef705fbd769a006530c43230b0cad3fbc9321ccc15615012ef05213786cacd63f1dfd53d16065d895705928d6e6469e3011a5b58509f18995cde37ba63736bffd4c843d995320349f2514a56d0ec3398c0cae3d997c29c3a64dee0fa2f888d4651a126dcee8738490dd522aa93ddfb43ec65b148ca6eef88cd98c72dd851e266a25cf276db42844ebc3abc9865cf83af1a37ba473a2bfadec32de421a00af6113684f0db1685f9af3c702a3663011c132620074f33fdd89fe4c5bd6a221362e1dc8e899d71aac8b996d6fe90e5b05904c09b665b8cacab520e9d12662ed9ccf6f4e2f1fa8cc73d28af44e0b66634951afc84546d281a875a2f13051001a4eb89235058e6ed3ffac7b07cad57e3d84e598430b2ab6df9f53c8ad428a3fc0f72652cd1305c4c613274c1988dd8c39b05780f50ac0811691c8c36fa1349a03a976a5e2281ee811e238e653cd11100076add796d98d322c50a0ff0004c4864e4e67b75d1a2cdd17e4fa40b1ced298441e534643c7c78ef579fbb";

      expect(await signer.verifyICAOSignature(signedAttributes, icaoMemberSignature, icaoMemberKey)).to.be.true;
    });

    it.only("should verify icao signature 2", async () => {
      const signedAttributes =
        "0x308203c9a003020102020401000011304106092a864886f70d01010a3034a00f300d06096086480165030402030500a11c301a06092a864886f70d010108300d06096086480165030402030500a203020140305d311a301806035504030c11637363612d6d6f6e74656e6567726f2d32311d301b060355040b0c144d696e6973747279206f6620496e746572696f7231133011060355040a0c0a4d6f6e74656e6567726f310b3009060355040613024d45301e170d3233313031333032303030305a170d3334303131333032303030305a3066310b3009060355040613024d4531133011060355040a130a4d6f6e74656e6567726f311d301b060355040b13144d696e6973747279206f6620496e746572696f72312330210603550403131a64732d312d6d6f6e74656e6567726f2d323032302d51342d303130820122300d06092a864886f70d01010105000382010f003082010a0282010100966b5855b11429c43dbfa9a0c51b1e56004ffd90c94995442227f4f41a63bf08ddbb89e201be08852c35ee9bc4c4c84537253a3092e00536582d85c158b37c730cc37b610de26f1a1ac156abe8c0fd0f88cab63f25560b53110250900dbdbaf7d3a3a81826b9cec1c140e87aa3e8e821cd52b2fc02b57117b8b2df99db91c9bbd4b8dd517f0a4e46faf718b7ea63eb99927fb883bd642fd23c71e04c0463e03ad2fb37e5bd6439ba7219ce55afe4d5e3eb7e848de571c997c4e3c50e1f54287a92325c0d716399ac624c57f2852d2c7a5f6e80bc024a932dd3e5b08ba4a885bf94159fd0b7a78483b5ef22e1d923f432436fc0b00e2e562fd10239f46c736a1b0203010001a382016a30820166302b0603551d1004243022800f32303233313031333032303030305a810f32303234303131333032303030305a30480603551d110441303f810f63736361406d75702e676f762e6d65861a687474703a2f2f7777772e637363612e6d75702e676f762e6d65a410300e310c300a06035504070c034d4e4530480603551d120441303f810f63736361406d75702e676f762e6d65861a687474703a2f2f7777772e637363612e6d75702e676f762e6d65a410300e310c300a06035504070c034d4e45300e0603551d0f0101ff040403020780301f0603551d230418301680149b1e9a5967c799bedaacf0e9db21939a40678061301d0603551d0e04160414ae5f18361e06a508f9293ed0a2d3890be79f410630380603551d1f0431302f302da02ba0298627687474703a2f2f7777772e637363612e6d75702e676f762e6d652f43524c732f4d4e452e63726c3019060767810801010602040e300c020100310713015013024944";
      const icaoMemberSignature =
        "0x47f32a6590002f1c38b9b47439d51deeddbb591abd2958e4d5be34581499f7aec26f1286a68b055a3f224ac6c8f903d4dd4b74d6058921d5c6a7fbfec59976d18909835e703762d6534876a257beceb05b281148b7c8a326de5c1e2200d159f6a2b1e7be4878237e3840debc48f63cefe36a9122dd2328d8fe0b7dfaf950b7568abdcae1a17a134addc5662d02df208dc3b7fee797f42a3fe83922fa1f9cc2e73d4bc84f05a9c9cf04ae266b51513dc63be2bf99d31415153a810413bfa2afcb405fd7f49a65915c91b7b205c461fcfff85b53847fe03dab29746b9214155987c2854e648c82f1b495205feb41d7368677a727fc38e64245b7c6c2a72d2efe0e92edd1295484b20165e48fbb7ea091dd78c207703a05368b6c336c42eef8a23a0d5c42db47897240f4f3c082f8c212a1bba93b88593660ba8a698d2d1ed0fc8fd438bc11b22c05f53b236d954aa69722be68353ef81373625ab168c33df79a1bd26d1475bf1aa7ecc3fba9b080c3827a2bbdddb0328a66230a9d763c42ec4c50d66d5654a42ce1daa1606683e2c29a1819a737e188f73ebcf3263f63525be672cf4a787b8606a6da3c0dcabf6c07549a7c41064a0093642f0e89a1d2aa5aa2d7deaf806c0fd214e86672750165ae962828fc7e2c66c7bd7e58dc9e3e43db3ff3cb1b463bd25a05ac626678048b701640678b6aba52da6e8029f4b6af7c45c08c";
      const icaoMemberKey =
        "0xba08f94da862bf155307131aacf5e465251eb3af49d4057db1ebef96107391df8062291d57f182d295076e2b3468b8504d1c5d1982564a078bf06951e04e88f4c302ec1cf058e29b942a6cd58316734e4096e397716e70b83b229ad8f74d7222c6b298e0548f8b6392117ff77425754dcf0ad15d68370810f5fa4e5ab62f3cc11ea488a9fed336c5a1156a5a763aad6e373192b85419d9728e1bafa1c489ca2e0e3368faf932a643e29f814c34f4500c5b8ffd80be0d2c30fa2a6cdc5842a0e7084fc75684e1f9c462b552e9cf0731b9f63f45866d6ae35f66a68be0ff3dd600f67917f3053459e771d52f40d11daf5dcfa5223edb0832f658f676098c2d871bc5cc2522f555bcba81546efed66ab1bb27504e7cada9d3ed60c4a28d07229304aad3a97f7479c27057afa8d82f546b3f7b7150d8c2400efa504652ac0e2ec3de3193a1d0de74531c028e820999996ee864ecb8582e990847153eff236eb9b85d53e3445f937b48832f2d5a65d6d18ebe8c99d0a108c5c493775b948bd44c264fdd0d70df09ff0d0fe52c156494939b9a70f853feee8785b90cb0c5f21d252018131512b3deb54b8db14f365ddb9aa1c51075dd98d4ad74ffc9fed59567d07e9bac761a2424462556119e41404d871ac723e9d1aa2ac4726f6131f0ca04feb813214c8081383cbcbb18bc235828761fc31d79acb42cc6d1098ae5c264bde40a19";

      expect(await signer.verifyICAOSignature(signedAttributes, icaoMemberSignature, icaoMemberKey)).to.be.true;
    });
  });
});

import { ethers } from "hardhat";
import { expect } from "chai";
import { Reverter } from "@/test/helpers/";

import { CECDSA256Signer } from "@ethers-v6";

describe("CECDSA256Signer", () => {
  const reverter = new Reverter();

  let signerSha1: CECDSA256Signer;

  before("setup", async () => {
    const CECDSA256Signer = await ethers.getContractFactory("CECDSA256Signer");

    signerSha1 = await CECDSA256Signer.deploy();

    await signerSha1.__CECDSA256Signer_init(0, 0);

    await reverter.snapshot();
  });

  afterEach(reverter.revert);

  describe("#verifyICAOSignature", () => {
    it("should verify icao signature using SHA1", async () => {
      const signedAttributes =
        "0x308202c6a003020102020103300906072a8648ce3d04013079310b3009060355040613025255310f300d060355040713064d6f73636f7731123010060355040a13095354432041746c6173310c300a060355040b1303535a443119301706035504031310496c7961204c656f73686b6576696368311c301a06092a864886f70d010901160d737a64407374636e65742e7275301e170d3036303632313036333431395a170d3131303732353036333431395a3073310b3009060355040613025255310f300d06035504081306527573736961310c300a060355040a1303464d53311d301b060355040b13146f7464656c20706572736f6e616c697a616369693111300f0603550403130842696b6f762045563113301106092a864886f70d01090116046d61696c3082014b3082010306072a8648ce3d02013081f7020101302c06072a8648ce3d0101022100ffffffff00000001000000000000000000000000ffffffffffffffffffffffff305b0420ffffffff00000001000000000000000000000000fffffffffffffffffffffffc04205ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b031504c49d360886e704936a6678e1139d26b7819f7e900441046b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c2964fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5022100ffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551020101034200044276e83da90a3582b2711e953277e3257dbfd281a892464faa749a223732fb30560c549c390008bd30d6f53a9d67b7c710c5b424e22fff4cca069da9ea297f85a3523050300e0603551d0f0101ff040403020780301d0603551d0e04160414ef768026f94901807a773f9a8568f6452e66275b301f0603551d23041830168014f20ba4f2abbeee5e643593ec353aab68159f2786";
      const icaoMemberSignature =
        "0x32aca11ad7f67b00c79223e1a5808155f1f5b6acb9420e1c27abf688f755de441828c3d375ab83e1a0c7bfed6b33c0107c0ddcd495f2808724580a16723e5372";
      const icaoMemberKey =
        "0xb744936f58bb3fa2dfcdbbbb0654e69ecfefde57fa5f9f0e84676b0a84828d5eda65b48e1fc4d5fb1e12f6b59293080e2b39a3d812acb77ada1632c35f846699";

      expect(await signerSha1.verifyICAOSignature(signedAttributes, icaoMemberSignature, icaoMemberKey)).to.be.true;
    });
  });
});

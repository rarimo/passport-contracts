import { ethers } from "hardhat";
import { expect } from "chai";
import { Reverter } from "@/test/helpers/";

import { CECDSA512Signer } from "@ethers-v6";

describe("CECDSA512Signer", () => {
  const reverter = new Reverter();

  let signerSha512: CECDSA512Signer;

  before("setup", async () => {
    const CECDSA512Signer = await ethers.getContractFactory("CECDSA512Signer");

    signerSha512 = await CECDSA512Signer.deploy();

    await reverter.snapshot();
  });

  afterEach(reverter.revert);

  describe("#verifyICAOSignature", () => {
    it("should verify icao signature using SHA512", async () => {
      const signedAttributes =
        "0x308205faa0030201020202041f300a06082a8648ce3d04030430819e3144304206035504030c3b4175746f72696461646520436572746966696361646f7261204d696e6973746572696f206461732052656c61636f6573204578746572696f72657331343032060355040b0c2b4175746f72696461646520436572746966696361646f7261205261697a2042726173696c6569726120763431133011060355040a0c0a4943502d42726173696c310b3009060355040613024252301e170d3137303630383136333433385a170d3238303630353136333433385a3081833116301406035504030c0d6550617373204453434120763331473045060355040b0c3e4175746f72696461646520436572746966696361646f726120646f204d696e6973746572696f206461732052656c61636f6573204578746572696f72657331133011060355040a0c0a4943502d42726173696c310b300906035504061302425230820238308201af06072a8648ce3d0201308201a2020101304c06072a8648ce3d0101024100aadd9db8dbe9c48b3fd4e6ae33c9fc07cb308db3b3c9d20ed6639cca703308717d4d9b009bc66842aecda12ae6a380e62881ff2f2d82c68528aa6056583a48f330818404407830a3318b603b89e2327145ac234cc594cbdd8d3df91610a83441caea9863bc2ded5d5aa8253aa10a2ef1c98b9ac8b57f1117a72bf2c7b9e7c1ac4d77fc94ca04403df91610a83441caea9863bc2ded5d5aa8253aa10a2ef1c98b9ac8b57f1117a72bf2c7b9e7c1ac4d77fc94cadc083e67984050b75ebae5dd2809bd638016f7230481810481aee4bdd82ed9645a21322e9c4c6a9385ed9f70b5d916c1b43b62eef4d0098eff3b1f78e2d0d48d50d1687b93b97d5f7c6d5047406a5e688b352209bcb9f8227dde385d566332ecc0eabfa9cf7822fdf209f70024a57b1aa000c55b881f8111b2dcde494a5f485e5bca4bd88a2763aed1ca2b2fa8f0540678cd1e0f3ad80892024100aadd9db8dbe9c48b3fd4e6ae33c9fc07cb308db3b3c9d20ed6639cca70330870553e5c414ca92619418661197fac10471db1d381085ddaddb58796829ca9006902010103818200043c52f2b73dd0899681133c72506c074b3a4664ca9152fa1ccf6906b22bd3e7cb12711965fe505df2648bca866731ea4c91fb4d90ea905dc27a8e3b5285b21d51a39aad8e42d37b21190f193d96d7b66e5bfebd91935fb618c298a0b270e55a248fac31a94e65c7ab5cc7af166eaf89974dbfb7b99e9d31755c543b00478b9687a382025e3082025a301f0603551d23041830168014fc4ce0f76b6557a4d9edc8ca72ad0535517b674c30550603551d20044e304c304a0606604c010204163040303e06082b060105050702011632687474703a2f2f7265706f7369746f72696f2e73657270726f2e676f762e62722f646f63732f64706361636d72652e7064663081b80603551d1f0481b03081ad3034a032a030862e687474703a2f2f7265706f7369746f72696f2e73657270726f2e676f762e62722f6c63722f61636d72652e63726c3036a034a0328630687474703a2f2f636572746966696361646f73322e73657270726f2e676f762e62722f6c63722f61636d72652e63726c303da03ba0398637687474703a2f2f7265706f7369746f72696f2e69637062726173696c2e676f762e62722f6c63722f61636d72652f61636d72652e63726c304e06082b0601050507010104423040303e06082b060105050730028632687474703a2f2f7265706f7369746f72696f2e73657270726f2e676f762e62722f636164656961732f61636d72652e7037623081c40603551d110481bc3081b9a0220605604c010308a019041743415341204441204d4f45444120444f2042524153494ca03d0605604c010304a0340432323630393139363638393637343832303738373030303030303030303030303030303030303731333630373133444943524aa0230605604c010302a01a041857494c4c49414d2042415449535441205445495845495241a0190605604c010303a010040e3334313634333139303030353036811477746569786569726140636d622e676f762e6272300e0603551d0f0101ff040403020780";
      const icaoMemberSignature =
        "0x2de521168c35f06ad4c4d3fb3b3a7890556feda21abe2122a1a5ac19e890f5c830bed8a365e202f7d5ecff1212aae1007f148f2c654ce4b9d1532c90bc05902f22fa958208c8d5903151b543363f3856b1b7b4d26df97a881d4cebdbd1063be8ca61c46046896c6b51cc6ee7f10290396b0cf3e15f2fb88cd2090ab818210219";
      const icaoMemberKey =
        "0x12363cc8d50c67ca72ec54793827131a2060162d471c9d790e9f0c02bb014d202b7c76ff63ecc3793357f0265270a89e516481e2ae29516d8d44abf6ceb73371372662ce0c54285cbea98e079d99e04cee097e9272e714e0eca2d878551ce3d695eaee58bcab13ba69350bbfe11dbe714758e76819c45954d4f4a128bad7ed52";

      expect(await signerSha512.verifyICAOSignature(signedAttributes, icaoMemberSignature, icaoMemberKey)).to.be.true;
    });
  });
});
